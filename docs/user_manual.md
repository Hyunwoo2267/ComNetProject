# 사용자 매뉴얼

## 목차

1. [시작하기](#시작하기)
2. [서버 설정 및 실행](#서버-설정-및-실행)
3. [클라이언트 실행](#클라이언트-실행)
4. [게임 방법](#게임-방법)
5. [고급 기능](#고급-기능)
6. [문제 해결](#문제-해결)

## 시작하기

### 시스템 요구사항

- **운영체제**: Windows 10/11, Linux, macOS
- **Python**: 3.8 이상
- **Wireshark**: 최신 버전
- **네트워크**: TCP/IP 통신 가능한 환경

### 설치

1. **Python 설치 확인**:
   ```bash
   python --version
   ```
   Python 3.8 이상이 설치되어 있어야 합니다.

2. **프로젝트 다운로드**:
   ```bash
   git clone <repository-url>
   cd ComNetProject
   ```

3. **Wireshark 설치**:
   - Windows: [https://www.wireshark.org/download.html](https://www.wireshark.org/download.html)
   - Linux: `sudo apt-get install wireshark`
   - macOS: `brew install --cask wireshark`

## 서버 설정 및 실행

### 기본 실행

서버를 시작하려면:

```bash
python -m server.server
```

기본 설정:
- 호스트: 0.0.0.0 (모든 인터페이스)
- 포트: 9999

### 사용자 정의 설정

호스트와 포트를 변경하려면:

```bash
python -m server.server --host 192.168.1.100 --port 8888
```

### 서버 명령어

서버가 실행되면 다음 명령어를 사용할 수 있습니다:

| 명령어 | 설명 |
|--------|------|
| `start` | 게임 시작 (최소 2명 필요) |
| `stop` | 게임 중지 |
| `status` | 서버 상태 및 플레이어 목록 확인 |
| `quit` | 서버 종료 |

### 서버 상태 확인

`status` 명령어를 입력하면:

```
========== 서버 상태 ==========
플레이어 수: 3
게임 상태: PLAYING
현재 라운드: 2

플레이어 목록:
  - PlayerA (192.168.1.10) | 점수: 25 | HP: 90
  - PlayerB (192.168.1.20) | 점수: 30 | HP: 100
  - PlayerC (192.168.1.30) | 점수: 20 | HP: 80
===============================
```

## 클라이언트 실행

### GUI 클라이언트 (권장)

GUI 클라이언트를 실행하려면:

```bash
python -m client.gui --id PlayerA --host localhost --port 9999
```

**파라미터**:
- `--id`: 플레이어 ID (필수, 고유해야 함)
- `--host`: 서버 호스트 (기본값: localhost)
- `--port`: 서버 포트 (기본값: 9999)

**예시**:
```bash
# 로컬 서버에 연결
python -m client.gui --id Alice

# 원격 서버에 연결
python -m client.gui --id Bob --host 192.168.1.100 --port 9999
```

### CLI 클라이언트 (테스트용)

콘솔 클라이언트를 실행하려면:

```bash
python -m client.client --id PlayerA --host localhost --port 9999
```

CLI 명령어:
- `attack <player_id>`: 플레이어 공격
- `defense <ip1,ip2,...>`: 방어 제출
- `status`: 내 상태 확인
- `players`: 플레이어 목록
- `quit`: 종료

## 게임 방법

### 1. 게임 준비

#### 1.1 Wireshark 설정

1. **Wireshark 실행**

2. **네트워크 인터페이스 선택**:
   - Windows: "Ethernet" 또는 "Wi-Fi"
   - Linux: `lo` (로컬) 또는 `eth0` (네트워크)
   - macOS: `lo0` (로컬) 또는 `en0` (네트워크)

3. **캡처 시작**

4. **필터 설정**:
   ```
   tcp.port == 9999
   ```

#### 1.2 클라이언트 실행

```bash
python -m client.gui --id YourName
```

서버에 연결되면 "대기 중..." 상태가 됩니다.

### 2. 게임 시작

서버 관리자가 `start` 명령어를 입력하면 게임이 시작됩니다.

### 3. 게임 진행

#### 라운드 구조

각 라운드는 다음 단계로 구성됩니다:

1. **준비 단계 (10초)**
   - Wireshark 필터 확인
   - 게임 UI 준비

2. **게임 진행 단계 (90초)**
   - 서버가 더미 패킷 전송 (1-2초 간격)
   - 플레이어들이 서로 공격
   - Wireshark로 공격 탐지

3. **방어 입력 단계 (20초)**
   - 탐지한 공격자 IP 입력

4. **결과 발표**
   - 점수 및 HP 업데이트

#### 3.1 공격하기

**GUI 방법**:
1. 플레이어 목록에서 대상 선택
2. "선택한 플레이어 공격" 버튼 클릭

**효과**:
- 대상 플레이어에게 공격 패킷 전송
- 대상이 탐지하지 못하면 +5점 획득

#### 3.2 방어하기

**Wireshark에서 공격 탐지**:

1. 필터 적용:
   ```
   tcp.port == 9999 && ip.dst == [내 IP] && tcp contains "ATTACK"
   ```

2. 공격 패킷의 "Source" 열에서 공격자 IP 확인

3. 발견한 모든 공격자 IP를 기록

**방어 제출**:

1. 방어 입력 창에 IP 입력 (쉼표로 구분):
   ```
   192.168.1.10, 192.168.1.30
   ```

2. "방어 제출" 버튼 클릭

**점수**:
- 정확한 방어: +10점
- 잘못된 IP: -5점
- 놓친 공격: -10 HP

### 4. 게임 종료

5라운드가 끝나면:
- 최종 순위 발표
- 가장 높은 점수를 가진 플레이어가 우승

## GUI 인터페이스 가이드

### 화면 구성

```
┌─────────────────────────────────────────────────┐
│ 네트워크 보안 게임 - PlayerA                       │
├─────────────────────────────────────────────────┤
│ [내 정보]                                        │
│ 플레이어: PlayerA | IP: 192.168.1.10             │
│ 점수: 25 | HP: 90 | 라운드: 2/5                   │
├─────────────────────────────────────────────────┤
│ [게임 상태]                                      │
│ 게임 진행 중! (라운드 2)                           │
├─────────────────────────────────────────────────┤
│ [플레이어 목록]                                   │
│ ┌───────────────────────────────────────────┐   │
│ │ ID    │ IP          │ 점수 │ HP            │   │
│ │ Alice │ 192.168.1.10│  25  │ 90           │   │
│ │ Bob   │ 192.168.1.20│  30  │ 100          │   │
│ │ Carol │ 192.168.1.30│  20  │ 80           │   │
│ └───────────────────────────────────────────┘   │
│        [선택한 플레이어 공격]                      │
├─────────────────────────────────────────────────┤
│ [방어 입력]                                       │
│ 공격자 IP: [____________________] [방어 제출]      │
├─────────────────────────────────────────────────┤
│ [게임 로그]                                       │
│ [10:30:15] 서버 연결 성공: 192.168.1.10           │
│ [10:30:20] [게임] 게임 시작!                      │
│ [10:30:35] [공격] Bob를 공격했습니다!              │
│ [10:31:00] [경고] Alice에게 공격 받음!             │
└─────────────────────────────────────────────────┘
```

### UI 요소 설명

1. **내 정보**: 플레이어 ID, IP, 점수, HP, 라운드
2. **게임 상태**: 현재 게임 단계
3. **플레이어 목록**: 모든 플레이어 정보
4. **방어 입력**: 공격자 IP 제출
5. **게임 로그**: 게임 이벤트 기록

## 고급 기능

### 네트워크 설정

#### 로컬 테스트

같은 컴퓨터에서 테스트:

```bash
# 터미널 1: 서버
python -m server.server --host 127.0.0.1

# 터미널 2: 클라이언트 1
python -m client.gui --id Alice --host 127.0.0.1

# 터미널 3: 클라이언트 2
python -m client.gui --id Bob --host 127.0.0.1
```

Wireshark 인터페이스: **Loopback (lo 또는 lo0)**

#### LAN 환경

같은 네트워크의 여러 컴퓨터:

1. **서버 컴퓨터**:
   ```bash
   # 내 IP 확인
   ipconfig  # Windows
   ifconfig  # Linux/macOS

   # 서버 시작 (예: 내 IP가 192.168.1.100인 경우)
   python -m server.server --host 192.168.1.100
   ```

2. **클라이언트 컴퓨터들**:
   ```bash
   python -m client.gui --id Alice --host 192.168.1.100
   ```

3. **방화벽 설정**:
   - Windows: 포트 9999 인바운드 허용
   - Linux: `sudo iptables -A INPUT -p tcp --dport 9999 -j ACCEPT`

### 게임 설정 변경

`common/constants.py` 파일을 수정하여 게임 설정을 변경할 수 있습니다:

```python
# 게임 설정
MIN_PLAYERS = 2          # 최소 플레이어 수
MAX_PLAYERS = 4          # 최대 플레이어 수
TOTAL_ROUNDS = 5         # 전체 라운드 수
ROUND_TIME = 90          # 라운드 시간 (초)
DEFENSE_INPUT_TIME = 20  # 방어 입력 시간 (초)

# 점수 설정
SCORE_CORRECT_DEFENSE = 10     # 정확한 방어
SCORE_WRONG_DEFENSE = -5       # 잘못된 방어
SCORE_MISSED_ATTACK = -10      # 놓친 공격 (HP 감소)
SCORE_SUCCESSFUL_ATTACK = 5    # 공격 성공

# 더미 패킷 설정
DUMMY_PACKET_INTERVAL_MIN = 1.0  # 최소 간격 (초)
DUMMY_PACKET_INTERVAL_MAX = 2.0  # 최대 간격 (초)
```

## 문제 해결

### 연결 문제

#### 문제: "서버에 연결할 수 없습니다"

**해결책**:
1. 서버가 실행 중인지 확인
2. 호스트와 포트가 올바른지 확인
3. 방화벽 설정 확인
4. 네트워크 연결 확인

#### 문제: "Connection refused"

**원인**: 서버가 실행되지 않음

**해결**: 서버를 먼저 시작하세요

### Wireshark 문제

#### 문제: 패킷이 캡처되지 않음

**해결책**:
1. 올바른 네트워크 인터페이스 선택
2. 캡처가 시작되었는지 확인
3. 필터가 올바른지 확인
4. 권한 문제 (Linux): `sudo wireshark` 또는 사용자 권한 설정

#### 문제: 공격 패킷이 보이지 않음

**해결책**:
1. 필터 확인: `tcp.port == 9999 && tcp contains "ATTACK"`
2. 실제로 공격을 받았는지 확인
3. 내 IP를 목적지로 하는 패킷만 필터링

### 게임 문제

#### 문제: 게임이 시작되지 않음

**원인**: 플레이어 수 부족

**해결**: 최소 2명의 플레이어가 필요합니다

#### 문제: 점수가 올라가지 않음

**원인**: 잘못된 IP 입력 또는 공격을 받지 않음

**해결**:
1. Wireshark에서 정확한 IP 확인
2. Source 열의 IP를 정확히 복사
3. 실제로 공격을 받았는지 확인

### 성능 문제

#### 문제: 게임이 느림

**해결책**:
1. 더미 패킷 간격 증가 (`DUMMY_PACKET_INTERVAL_MIN/MAX`)
2. 플레이어 수 줄이기
3. 네트워크 대역폭 확인

#### 문제: Wireshark가 너무 많은 패킷 표시

**해결책**:
1. 필터를 더 구체적으로 설정
2. 다른 프로그램의 네트워크 사용 중지
3. 필요한 인터페이스만 캡처

## 팁과 요령

### 게임 전략

1. **방어 우선**:
   - 공격보다 방어가 더 중요 (놓친 공격은 -10 HP)
   - Wireshark를 항상 확인하세요

2. **효율적인 공격**:
   - 여러 플레이어를 골고루 공격
   - 한 명만 집중 공격하면 다른 플레이어가 이길 수 있음

3. **시간 관리**:
   - 방어 입력 시간은 20초뿐
   - 미리 IP를 기록해두세요

### Wireshark 팁

1. **빠른 IP 확인**:
   - "Source" 열을 넓게 설정
   - 색상 규칙으로 공격 패킷 강조

2. **필터 미리 저장**:
   - 자주 사용하는 필터를 북마크

3. **마크 활용**:
   - 공격 패킷을 마크하여 나중에 확인

## 부록

### A. 단축키

#### 서버
- `Ctrl+C`: 서버 중지

#### GUI 클라이언트
- (클라이언트 윈도우가 포커스된 상태에서)
- 창 닫기: 게임 종료 확인 후 연결 해제

#### Wireshark
- `Ctrl+K`: 캡처 시작
- `Ctrl+E`: 캡처 중지
- `Ctrl+F`: 패킷 찾기
- `Ctrl+M`: 패킷 마크

### B. 포트 및 프로토콜

| 항목 | 값 |
|------|-----|
| 기본 포트 | 9999 |
| 프로토콜 | TCP |
| 인코딩 | UTF-8 |
| 메시지 형식 | JSON |

### C. 점수 계산 표

| 행동 | 점수 | HP |
|------|------|----|
| 정확한 방어 | +10 | 0 |
| 잘못된 IP 입력 | -5 | 0 |
| 공격 탐지 실패 | 0 | -10 |
| 공격 성공 | +5 | 0 |

### D. 게임 상태

| 상태 | 설명 |
|------|------|
| WAITING | 대기 중 |
| PREPARATION | 준비 단계 |
| PLAYING | 게임 진행 중 |
| DEFENSE | 방어 입력 단계 |
| ROUND_END | 라운드 종료 |
| GAME_END | 게임 종료 |

## 자주 묻는 질문 (FAQ)

### Q1: 혼자 게임을 테스트할 수 있나요?

A: 네, 같은 컴퓨터에서 여러 클라이언트를 실행하면 됩니다. 각 클라이언트는 다른 플레이어 ID를 사용해야 합니다.

### Q2: 인터넷을 통해 플레이할 수 있나요?

A: 네, 가능합니다. 단, 서버의 공인 IP와 포트 포워딩이 필요합니다.

### Q3: 게임 중에 연결이 끊어지면?

A: 다시 연결하면 새 플레이어로 취급됩니다. 이전 점수는 복구되지 않습니다.

### Q4: 최대 몇 명까지 플레이할 수 있나요?

A: 기본적으로 4명입니다. `constants.py`에서 변경할 수 있습니다.

### Q5: 모바일에서 플레이할 수 있나요?

A: 현재 모바일은 지원하지 않습니다. PC에서만 플레이 가능합니다.

## 지원

문제가 발생하면:
1. 이 매뉴얼의 "문제 해결" 섹션 확인
2. `docs/wireshark_guide.md` 참조
3. GitHub Issues에 문의

---

즐거운 게임 되세요!
